{
  "openapi": "3.0.3",
  "info": {
    "title": "API de Inadimplência Veicular",
    "version": "1.1.0",
    "description": "API para registro, consulta e gestão de inadimplência veicular, incluindo autenticação, cancelamento, apreensão e averbação."
  },
  "paths": {
    "/autenticacao": {
      "post": {
        "summary": "Gerar token JWT",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "usuario": {
                    "type": "string"
                  },
                  "senha": {
                    "type": "string"
                  }
                },
                "required": ["usuario", "senha"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token JWT gerado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TokenResponse"
                }
              }
            }
          },
          "401": {
            "description": "Acesso inválido",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroPadrao"
                }
              }
            }
          }
        }
      }
    },
    "/registro": {
      "post": {
        "summary": "Registrar inadimplência",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "placa": {
                    "type": "string"
                  },
                  "renavam": {
                    "type": "string"
                  },
                  "docProprietario": {
                    "type": "string"
                  },
                  "phoneProprietario": {
                    "type": "string"
                  },
                  "emailProprietario": {
                    "type": "string"
                  },
                  "idContrato": {
                    "type": "string"
                  },
                  "docCredor": {
                    "type": "string"
                  },
                  "dataContrato": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "valorDebito": {
                    "type": "number"
                  },
                  "valorContrato": {
                    "type": "number"
                  },
                  "parcelasAtraso": {
                    "type": "integer"
                  },
                  "urlAtendimento": {
                    "type": "string"
                  },
                  "urlPagamento": {
                    "type": "string"
                  },
                  "observacoes": {
                    "type": "string"
                  },
                  "dataCriacao": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "dataAtualizacao": {
                    "type": "string",
                    "format": "date-time"
                  }
                },
                "required": [
                  "placa",
                  "renavam",
                  "docProprietario",
                  "idContrato",
                  "docCredor",
                  "dataContrato",
                  "valorDebito",
                  "valorContrato",
                  "parcelasAtraso",
                  "urlAtendimento",
                  "urlPagamento",
                  "observacoes",
                  "dataCriacao",
                  "dataAtualizacao"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Cadastro de inadimplência criado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "idRegistro": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "dataCriacao": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "status": {
                      "$ref": "#/components/schemas/RegistroStatus"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "404": {
            "description": "Renavam inexistente"
          },
          "401": {
            "description": "Acesso Inválido"
          }
        },
        "description": "- O contrato deve estar inadimplente, com parcelas em atraso.\n- O credor fiduciário deve fornecer URLs para pagamento e negociação.\n- Verificar validade de Placa + Renavam + Doc Proprietário e inexistência de registro ativo/finalizado.\n- Verificar vínculo do docCredor à alienação fiduciária do veículo.\n- Notificar o proprietário por todos os canais conhecidos.\n- Registrar restrição de circulação do veículo."
      }
    },
    "/registro/{renavam}": {
      "get": {
        "summary": "Consultar registro de inadimplência",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "renavam",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Registro encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegistroCompleto"
                }
              }
            }
          },
          "404": {
            "description": "Não há registro para este Renavam"
          },
          "401": {
            "description": "Acesso Inválido"
          }
        },
        "description": "- Retorna todos os dados do registro de inadimplência vinculado ao Renavam informado."
      },
      "delete": {
        "summary": "Cancelar registro de inadimplência",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "idRegistro": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "placa": {
                    "type": "string"
                  },
                  "docProprietario": {
                    "type": "string"
                  },
                  "idContrato": {
                    "type": "string"
                  },
                  "docCredor": {
                    "type": "string"
                  },
                  "motivoCancelamento": {
                    "type": "string",
                    "maxLength": 255
                  },
                  "status": {
                    "enum": ["CANCELADO"]
                  }
                },
                "required": [
                  "idRegistro",
                  "placa",
                  "docProprietario",
                  "idContrato",
                  "docCredor",
                  "motivoCancelamento",
                  "status"
                ]
              }
            }
          },
          "responses": {
            "200": {
              "description": "Registro cancelado",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/RegistroCompleto"
                  }
                }
              }
            },
            "404": {
              "description": "Não há registro para este Renavam"
            },
            "401": {
              "description": "Acesso Inválido"
            }
          }
        },
        "description": "- Apenas registros com status 'ATIVO', 'APREENSAO' ou 'APREENDIDO' podem ser cancelados.\n- O motivo do cancelamento deve conter no máximo 255 caracteres.\n- Verificar vínculo do docCredor e validade dos dados do veículo e proprietário."
      }
    },
    "/apreensao/{idRegistro}": {
      "post": {
        "summary": "Emitir ordem de busca e apreensão",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "idRegistro",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "placa": {
                    "type": "string"
                  },
                  "renavam": {
                    "type": "string"
                  },
                  "docCredorAgente": {
                    "type": "string"
                  }
                },
                "required": ["placa", "renavam", "docCredorAgente"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ordem emitida",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegistroCompleto"
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "404": {
            "description": "Renavam inexistente"
          },
          "401": {
            "description": "Acesso Inválido"
          }
        },
        "description": "- Apenas registros com status 'ATIVO' podem ser apreendidos.\n- Verificar vínculo do docCredor e validade do registro e dados do veículo.\n- Ordem de busca só pode ser emitida após 7 dias do registro de inadimplência.\n- O status do registro será alterado para: APREENSAO."
      },
      "put": {
        "summary": "Registrar auto de apreensão",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "placa": {
                    "type": "string"
                  },
                  "renavam": {
                    "type": "string"
                  },
                  "docCredorAgente": {
                    "type": "string"
                  },
                  "imagensVeiculo": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uri"
                    }
                  },
                  "descricaoApreensao": {
                    "type": "string"
                  },
                  "localizacao": {
                    "type": "array",
                    "items": {
                      "type": "number"
                    },
                    "minItems": 2,
                    "maxItems": 2
                  },
                  "endereco": {
                    "type": "string"
                  },
                  "dataApreensao": {
                    "type": "string",
                    "format": "date-time"
                  }
                },
                "required": [
                  "placa",
                  "renavam",
                  "docCredorAgente",
                  "imagensVeiculo",
                  "descricaoApreensao",
                  "localizacao",
                  "endereco",
                  "dataApreensao"
                ]
              }
            }
          },
          "responses": {
            "200": {
              "description": "Auto registrado com sucesso",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/RegistroCompleto"
                  }
                }
              }
            },
            "400": {
              "description": "Dados inválidos"
            },
            "404": {
              "description": "Renavam inexistente"
            },
            "401": {
              "description": "Acesso Inválido"
            }
          }
        },
        "description": "- Apenas registros com status 'APREENSAO' podem ser apreendidos.\n- Verificar vínculo do docCredor e validade dos dados do veículo.\n- O status do registro será alterado para: APREENDIDO."
      }
    },
    "/averbacao/{idRegistro}": {
      "post": {
        "summary": "Registrar a averbação do veículo",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "idRegistro",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "placa": {
                    "type": "string"
                  },
                  "renavam": {
                    "type": "string"
                  },
                  "docProprietario": {
                    "type": "string"
                  },
                  "idContrato": {
                    "type": "string"
                  },
                  "docCredor": {
                    "type": "string"
                  }
                },
                "required": ["placa", "renavam", "docProprietario", "idContrato", "docCredor"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Averbação registrada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegistroCompleto"
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "404": {
            "description": "Renavam inexistente"
          },
          "401": {
            "description": "Acesso Inválido"
          }
        },
        "description": "- Apenas registros com status 'APREENDIDO' podem ser transferidos.\n- Verificar vínculo do docCredor e validade do registro e dados do veículo.\n- Não pode haver dívidas ativas para efetivar a transferência.\n- A transferência só pode ser feita para o docCredor registrado."
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "TokenResponse": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string"
          }
        }
      },
      "ErroPadrao": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          }
        }
      },
      "RegistroStatus": {
        "type": "string",
        "enum": ["ATIVO", "APREENSAO", "APREENDIDO", "CANCELADO", "TRANSFERIDO"]
      },
      "RegistroBase": {
        "type": "object",
        "properties": {
          "placa": {
            "type": "string"
          },
          "renavam": {
            "type": "string"
          },
          "docProprietario": {
            "type": "string"
          },
          "idContrato": {
            "type": "string"
          },
          "docCredor": {
            "type": "string"
          },
          "dataContrato": {
            "type": "string",
            "format": "date-time"
          },
          "valorDebito": {
            "type": "number"
          },
          "valorContrato": {
            "type": "number"
          },
          "parcelasAtraso": {
            "type": "integer"
          },
          "urlAtendimento": {
            "type": "string"
          },
          "urlPagamento": {
            "type": "string"
          },
          "observacoes": {
            "type": "string"
          },
          "dataCriacao": {
            "type": "string",
            "format": "date-time"
          },
          "dataAtualizacao": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "placa",
          "renavam",
          "docProprietario",
          "idContrato",
          "docCredor",
          "dataContrato",
          "valorDebito",
          "valorContrato",
          "parcelasAtraso",
          "urlAtendimento",
          "urlPagamento",
          "observacoes",
          "dataCriacao",
          "dataAtualizacao"
        ]
      },
      "RegistroCompleto": {
        "allOf": [
          {
            "$ref": "#/components/schemas/RegistroBase"
          },
          {
            "type": "object",
            "properties": {
              "idRegistro": {
                "type": "string",
                "format": "uuid"
              },
              "status": {
                "$ref": "#/components/schemas/RegistroStatus"
              },
              "docCredorAgente": {
                "type": "string"
              },
              "imagensVeiculo": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                }
              },
              "descricaoApreensao": {
                "type": "string"
              },
              "localizacao": {
                "type": "array",
                "items": {
                  "type": "number"
                },
                "minItems": 2,
                "maxItems": 2
              },
              "endereco": {
                "type": "string"
              },
              "dataApreensao": {
                "type": "string",
                "format": "date-time"
              },
              "motivoCancelamento": {
                "type": "string"
              }
            }
          }
        ]
      }
    }
  }
}
